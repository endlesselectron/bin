#!/bin/bash

function issue_start() {
    git fetch upstream develop &&
        git checkout upstream/develop &&
        git checkout -b issues/$(printf %05d ${1})/$(uuidgen) &&
        git push origin $(git rev-parse --abbrev-ref HEAD) &&
        true
}

function issue_rebase() {
    git fetch upstream develop &&
        ISSUE=$(git rev-parse --abbrev-ref HEAD | sed -e "s#^issues\/##" | sed -e "s#\/.*\$##") &&
        git checkout -b issues/${ISSUE}/$(uuidgen) &&
        git rebase upstream/develop &&
        git push origin $(git rev-parse --abbrev-ref HEAD)
        true
}

function issue_finish() {
    issue_rebase &&
        ISSUE=$(git rev-parse --abbrev-ref HEAD | sed -e "s#^issues\/##" | sed -e "s#\/.*\$##") &&
        git checkout -b merge-requests/${ISSUE}/$(date +%Y%b%d%H%M) &&
        git reset --soft upstream/develop &&
        git commit &&
        git push origin $(git rev-parse --abbrev-ref HEAD) &&
        true
}

case ${1} in
    issue)
    case ${2} in
        start)
            issue_start ${3} &&
                true
        ;;
        rebase)
            issue_rebase &&
                true
        ;;
        finish)
            issue_finish &&
                true
    esac
    ;;
esac